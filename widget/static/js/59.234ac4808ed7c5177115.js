webpackJsonp([59],{"2CLL":function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=s("Gu7T"),o=s.n(e),n=s("mvHQ"),a=s.n(n),c=s("Au9i"),l=(s.n(c),s("ABCa")),d=s.n(l);i.default={name:"credit_circle",data:function(){return{users:localStorage.getItem("users")?JSON.parse(localStorage.getItem("users")):"",more_state:1,left:"",leftonoff:!1,dianzan:[],page:1,activeinputall:!1,reloadState:1,loading:!1,popupVisible:!1,arrow:!0,list:[],showcommon:!1,activezan:!1,textmodel:"",listcomdetail:[],id:"",pid:"",idshow:"",comlist:[],comlistshow:!1,indexed:"",indexn:"",touser:"",showhuifu:!1,nickname:"",click_num_id:"",clientHeight:window.innerHeight,timer:!1,isFocus:!1,read:!0}},components:{LoadMore:c.LoadMore,Popup:c.Popup,Lazyload:c.Lazyload,Actionsheet:c.Actionsheet,XHeader:d.a},created:function(){this.getList()},mounted:function(){this.$nextTick(function(){})},filters:{ismycircle:function(t){return console.log(t),t?1===(t=JSON.parse(t)).is_my_post:""}},methods:{getList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=this,s=arguments[1],e=arguments[2];this.$axios.post("/api/Post/post_list","data="+a()({session_id:this.users.session_id,userId:this.users.userId,page:t})).then(function(t){if(200==t.code){if(s&&s(),e)return i.list=t.data.list,i.reloadState=1,!1;t.data.list.length<=t.data.pageSize&&(i.more_state=2,i.loading=!0),i.list=[].concat(o()(i.list),o()(t.data.list))}else 401==t.code&&(i.reloadState=2,i.$router.push("/my/login"))}).catch(function(t){i.reloadState=3})},loadMore:function(){var t=this;this.page++,this.loading=!0,this.getList(this.page,function(){t.loading=!1})},loadTop:function(){var t=this;this.page=1,this.getList(this.page,function(){t.popupVisible=!0,t.$refs.loadmore.onTopLoaded(),t.more_state=1,t.loadMore(),setTimeout(function(){t.popupVisible=!1},2e3)},!0)},addcomment:function(t,i){var s=this;this.leftonoff=!1,this.comlistshow=!0,this.id=t,this.indexed=i,s.activeinputall=!0,setTimeout(function(){s.$refs.inputfocusfff.focus();var t=s.$refs.inputfocusfff;t.scrollIntoView(!0),t.scrollIntoViewIfNeeded()},500)},addcommentinside:function(t,i,s,e,o,n){var l=this;if(this.id=t,this.pid=1,this.indexn=i,this.touser=s,this.nickname=e,1==o){var d=this;return c.MessageBox.confirm("确定删除该评论?").then(function(s){l.$axios.post("/api/Post/del_my_comment","data="+a()({session_id:l.users.session_id,userId:l.users.userId,id:l.touser})).then(function(s){200==s.code?(Object(c.Toast)(s.msg),d.touser="",console.log(d.list[i].comment_num,i),--d.list[n].comment_num,d.list[n].comment_num<=0&&(d.list[n].comment_num=0),d.common_list(t,i)):Object(c.Toast)(s.msg)}).catch(function(t){throw t})}),!1}d=this;return setTimeout(function(){document.body.scrollTop=document.body.scrollHeight,d.activeinputall=!0},300),!1},zan:function(t,i){var s=this;this.$axios.post("/api/Post/do_likenum","data="+a()({session_id:this.users.session_id,userId:this.users.userId,post_id:t})).then(function(t){200==t.code?(s.leftonoff=!1,0===s.list[i].is_likenum?(s.list[i].is_likenum=1,s.dianzan[i]=!1,++s.list[i].click_num):(s.list[i].is_likenum=0,s.dianzan[i]=!0,--s.list[i].click_num)):Object(c.Toast)(t.msg)}).catch(function(t){throw t})},leftid:function(t,i){this.idshow=t,this.left=i,this.common_list(t,i)},buttonAddTodo:function(){var t=this;return this.activeinputall=!1,this.textmodel?1!=this.pid?(this.$axios.post("/api/Post/do_comment","data="+a()({session_id:this.users.session_id,userId:this.users.userId,post_id:this.id,content:this.textmodel})).then(function(i){if(200==i.code){var s=t.indexed;s=Number(s)||0,t.comlist.push({nickname:t.users.nickname,content:t.textmodel,post_id:t.id}),++t.list[s].comment_num,Object(c.Toast)(i.msg),t.getList(),t.activeinputall=!1,t.textmodel=""}else t.activeinputall=!1,t.textmodel="",Object(c.Toast)(i.msg)}).catch(function(t){throw t}),!1):1==this.pid?(this.$axios.post("/api/Post/do_comment","data="+a()({session_id:this.users.session_id,userId:this.users.userId,post_id:this.id,content:this.textmodel,pid:this.touser})).then(function(i){if(200==i.code){var s=t.indexn;s=Number(s)||0,t.comlist.push({nickname:t.users.nickname,content:t.textmodel,post_id:t.id,to_user:t.nickname}),Object(c.Toast)(i.msg),t.activeinputall=!1,t.textmodel="",t.touser="",t.getList()}else t.activeinputall=!1,t.textmodel="",Object(c.Toast)(i.msg)}).catch(function(t){throw t}),!1):void 0:(Object(c.Toast)("请输入内容"),!1)},common_list:function(t,i){var s=this;return 0==this.comlistshow?(localStorage.setItem("idshow",this.idshow),this.comlistshow=!0,this.leftonoff=!0,this.click_num_id=t,this.$axios.post("/api/Post/v1_see_comment","data="+a()({session_id:this.users.session_id,userId:this.users.userId,id:t})).then(function(t){200==t.code?s.comlist=t.data.list.comment:Object(c.Toast)(t.msg)}).catch(function(t){throw t}),!1):1==this.comlistshow?t===parseInt(localStorage.getItem("idshow"))?(this.comlistshow=!1,this.leftonoff=!1,this.click_num_id=t,!1):(this.comlistshow=!0,this.leftonoff=!0,this.click_num_id=t,this.$axios.post("/api/Post/v1_see_comment","data="+a()({session_id:this.users.session_id,userId:this.users.userId,id:t})).then(function(t){200==t.code?s.comlist=t.data.list.comment:Object(c.Toast)(t.msg)}).catch(function(t){throw t}),!1):void 0},delpost:function(t,i){var s=this;c.MessageBox.confirm("确定删除该帖子?").then(function(e){s.$axios.post("/api/Post/del_my_post","data="+a()({session_id:s.users.session_id,userId:s.users.userId,id:t})).then(function(t){200==t.code?(Object(c.Toast)(t.msg),s.list.splice(i,1)):Object(c.Toast)(t.msg)}).catch(function(t){throw t})})},calc:function(){document.getElementById("lines").value=document.getElementById("text").value.split("\n").length},offFocus:function(){this.activeinputall=!1}},watch:{textmodel:function(t,i){this.read=""==t,$(this.$refs.inputfocusfff).css("height","30px"),$(this.$refs.inputfocusfff).css("height",this.$refs.inputfocusfff.scrollHeight)},clientHeight:function(t,i){t<i&&setTimeout(function(){this.$refs.inputall.scrollIntoView(!0)},100)},activeinputall:function(t,i){!0===t?($(".mint-tabbar").css("z-index","-1"),$(".main").css("bottom","0")):($(".mint-tabbar").css("z-index","1"),$(".main").css("bottom","60px"))},dianzanindex:function(t,i){console.log(t,i)}},computed:{dianzanindex:function(){return function(){var t=localStorage.getItem("zanindex");localStorage.getItem("dianzan");return"true"==localStorage.getItem("dianzan")?this.dianzan[t]=!0:this.dianzan[t]=!1}}},directives:{focus:{update:function(t){t.focus()}}}}},"K+Af":function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"wrap bg-f0 h100p",attrs:{id:"my-credit-circle"}},[s("X-header",{attrs:{"left-options":{backText:""}}},[t._v("我的信贷圈")]),t._v(" "),s("div",{ref:"main",staticClass:"main",staticStyle:{height:"100%",overflow:"scroll"}},[s("mt-loadmore",{ref:"loadmore",attrs:{"top-method":t.loadTop,distanceIndex:5,autoFill:!0,topPullText:"↓ 下拉刷新",topDropText:"↑ 释放更新",topLoadingText:"正在加载 ...",topDistance:70}},[s("div",{staticClass:"mui-table-view"},[t._l(t.list,function(i,e){return 1===i.is_my_post?s("section",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],key:e,staticClass:"li bg-f0 clearfix",attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":50}},[s("div",{staticClass:"right-con "},[s("i",{staticClass:"lazy-c bg-f5 img-wrap-left"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.imgUrl+i.head_img,expression:"imgUrl+item.head_img"}],attrs:{alt:""}})]),t._v(" "),s("a",{attrs:{href:"javascript:void(0);"}},[t._v(t._s(i.nickname))]),t._v(" "),s("div",{ref:"addcom",refInFor:!0,staticClass:"main-content-one",on:{click:function(s){t.addcomment(i.id,e)}}},[t._v(t._s(i.content))]),t._v(" "),s("ul",{staticClass:"main-content-two clearfix"},t._l(i.images,function(i,e){return s("li",{key:e,staticClass:"lazy-c bg-f5 cont-two-li"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.imgUrl+i,expression:"imgUrl+img"}],attrs:{alt:"","data-preview-src":""}})])})),t._v(" "),s("div",{staticClass:"main-content-last clearfix"},[s("span",{staticClass:"fl"},[t._v("\n                                        "+t._s(t.moment(1e3*i.addtime).locale("zh-cn").startOf().fromNow())+"\n                                         "),1==i.is_my_post?s("a",{attrs:{href:"javascript:void(0);"},on:{click:function(s){t.delpost(i.id,e)}}},[t._v("删除")]):t._e()]),t._v(" "),s("span",{staticClass:"fr right-content"},[s("div",{staticClass:"left-comment ",class:e==t.left&&t.leftonoff?"":"left-commenthide"},[0===i.is_likenum?s("span",{on:{click:function(s){t.zan(i.id,e)}}},[s("i",{staticClass:"iconfont icon-dianzanb"}),t._v("赞")]):t._e(),t._v(" "),0!=i.is_likenum?s("span",{on:{click:function(s){t.zan(i.id,e)}}},[s("i",{staticClass:"iconfont icon-dianzanb"}),t._v("取消")]):t._e(),t._v(" "),s("span",{ref:"addcoms",refInFor:!0,on:{click:function(s){t.addcomment(i.id,e)}}},[s("i",{staticClass:"iconfont icon-pinglun1"}),t._v("评论")])]),t._v(" "),s("div",{staticClass:"right-comment ",on:{click:function(s){s.stopPropagation(),t.leftid(i.id,e)}}},[s("i",{staticClass:"iconfont icon-ttpodicon"}),t._v(t._s(i.comment_num)+"\n                                        ")])])])]),t._v(" "),s("div",{staticClass:"main-content-add"},[s("ul",{staticClass:"main-content-add-con"},[t.comlistshow&&i.id==t.click_num_id&&i.click_num?s("div",{staticClass:"dianzan"},[s("i",{staticClass:"iconfont icon-dianzanb"}),t._v("已有"+t._s(i.click_num)+"人点赞")]):t._e(),t._v(" "),t._l(t.comlist,function(o,n){return t.comlistshow&&i.id==o.post_id?s("li",{key:n,staticClass:"content-com"},[s("div",{staticClass:"content-inner",on:{click:function(s){t.addcommentinside(i.id,n,o.id,o.nickname,o.is_my_comment,e)}}},[s("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(o.nickname))]),t._v(" "),o.to_user?s("span",[t._v("回复"),s("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(o.to_user))])]):t._e(),t._v(":"+t._s(o.content))]),t._v(" "),s("div",{staticClass:"inner-wrap"})]):t._e()}),t._v(" "),s("router-link",{attrs:{to:{path:"/my/my-post-detail",query:{id:i.id}}}},[t._v("更多回复>>")])],2)])]):t._e()}),t._v(" "),s("div",{ref:"inputall",staticClass:"input-all",class:t.activeinputall?"":"write-phonenum-1000"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textmodel,expression:"textmodel"},{name:"focus",rawName:"v-focus",value:t.isFocus,expression:"isFocus"}],ref:"inputfocusfff",staticClass:"activeinput ",attrs:{id:"textarea"},domProps:{value:t.textmodel},on:{blur:t.offFocus,input:function(i){i.target.composing||(t.textmodel=i.target.value)}}}),t._v(" "),s("input",{ref:"inputright",staticClass:"right-input",attrs:{type:"submit",value:"发送",readonly:t.read},on:{click:function(i){t.buttonAddTodo()}}})]),t._v(" "),s("p",{staticClass:"page-infinite-loading"},[1==t.more_state?s("span",[s("mt-spinner",{attrs:{type:"fading-circle"}}),t._v("\n                                加载中...\n                            ")],1):t._e(),t._v(" "),2==t.more_state?s("span",[t._v("暂无更多数据")]):t._e()])],2)])],1),t._v(" "),s("mt-popup",{attrs:{position:"top",modal:"true"},model:{value:t.popupVisible,callback:function(i){t.popupVisible=i},expression:"popupVisible"}},[t._v(t._s(1==this.reloadState?"更新成功":2==this.reloadState?"更新失败":3==this.reloadState?"请求出错":""))])],1)},staticRenderFns:[]}},"NW/d":function(t,i){},NpIw:function(t,i,s){var e=s("VU/8")(s("2CLL"),s("K+Af"),function(t){s("NW/d"),s("TSXj")},"data-v-55e4fd82",null);t.exports=e.exports},TSXj:function(t,i){}});
//# sourceMappingURL=59.234ac4808ed7c5177115.js.map